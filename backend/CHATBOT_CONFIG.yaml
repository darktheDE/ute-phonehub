# ==============================================================================
# CHATBOT ASSISTANT USER - BACKEND CONFIGURATION
# ==============================================================================
# Th√™m ph·∫ßn n√†y v√†o application.yaml c·ªßa b·∫°n

# C·∫•u h√¨nh Gemini API
gemini:
  api:
    # L·∫•y t·ª´ https://ai.google.dev/
    key: ${GEMINI_API_KEY}
    
    # Base URL c·ªßa Gemini API
    url: ${GEMINI_API_URL:https://generativelanguage.googleapis.com/v1beta/models}
  
  # Model d√πng ƒë·ªÉ t·∫°o text response
  # C√≥ s·∫µn: gemini-2.0-flash, gemini-2.0-flash-lite, gemini-1.5-pro, gemini-1.5-flash
  model: ${GEMINI_MODEL:gemini-2.0-flash}
  
  # Model d√πng ƒë·ªÉ t·∫°o embedding vector
  embedding:
    model: ${GEMINI_EMBEDDING_MODEL:text-embedding-004}

# C·∫•u h√¨nh Product API
api:
  product:
    # URL base c·ªßa ProductView API
    base-url: ${API_PRODUCT_BASE_URL:http://localhost:8081/api/v1/products}

# ==============================================================================
# H∆Ø·ªöNG D·∫™N C·∫§U H√åNH CHI TI·∫æT
# ==============================================================================

# 1. ENVIRONMENT VARIABLES (.env ho·∫∑c docker-compose env)
# 
#    GEMINI_API_KEY=your_api_key_from_ai.google.dev
#    GEMINI_MODEL=gemini-2.0-flash
#    GEMINI_EMBEDDING_MODEL=text-embedding-004
#    API_PRODUCT_BASE_URL=http://localhost:8081/api/v1/products

# 2. L·∫§Y GEMINI API KEY
#
#    B∆∞·ªõc 1: V√†o https://ai.google.dev/
#    B∆∞·ªõc 2: Click "Get API Key" (ph·∫£i c√≥ Google Account)
#    B∆∞·ªõc 3: "Create API Key" ‚Üí t·∫°o m·ªõi ho·∫∑c d√πng project c≈©
#    B∆∞·ªõc 4: Copy key ‚Üí .env
#
#    Free Tier Limits:
#    - Text Generation: 15 requests/minute (RPM)
#    - Embedding: 15 RPM
#    - Free tier: $0 m√£i m√£i (nh∆∞ng c√≥ gi·ªõi h·∫°n RPM)
#
#    Paid Tier (t√πy ch·ªçn):
#    - Text: $0.075 / 1M input tokens
#    - Embedding: $0.02 / 1M tokens
#    - T·ªëi ∆∞u h√≥a, chi ph√≠ r·∫•t th·∫•p

# 3. APPLICATION.YAML V√ç D·ª§ ƒê·∫¶Y ƒê·ª¶
#
#    spring:
#      application:
#        name: ute-phonehub-backend
#      jpa:
#        hibernate:
#          ddl-auto: validate
#        properties:
#          hibernate:
#            dialect: org.hibernate.dialect.PostgreSQL10Dialect
#    
#    server:
#      port: 8081
#    
#    gemini:
#      api:
#        key: ${GEMINI_API_KEY}
#        url: https://generativelanguage.googleapis.com/v1beta/models
#      model: ${GEMINI_MODEL:gemini-2.0-flash}
#      embedding:
#        model: ${GEMINI_EMBEDDING_MODEL:text-embedding-004}
#    
#    api:
#      product:
#        base-url: ${API_PRODUCT_BASE_URL:http://localhost:8081/api/v1/products}

# ==============================================================================
# DEPENDENCIES (ƒê·∫†M√É C√ì TRONG POM.XML)
# ==============================================================================

# spring-boot-starter-web
# spring-boot-starter-data-jpa
# spring-boot-starter-data-redis (n·∫øu d√πng)
# spring-boot-starter-security
# spring-boot-starter-validation
# 
# Th√™m n·∫øu c·∫ßn:
# <dependency>
#     <groupId>org.springframework.boot</groupId>
#     <artifactId>spring-boot-starter-webflux</artifactId>
# </dependency>

# ==============================================================================
# PERFORMANCE TUNING
# ==============================================================================

# Cache Settings (ProductRecommendationService)
# CACHE_EXPIRY_MS: 3600000 (1 gi·ªù)
#   - Gi·∫£m s·ªë l·∫ßn g·ªçi API products
#   - Benefit: 80% reduction trong API calls
#   - N·∫øu c·∫ßn real-time data, gi·∫£m th√†nh 300000 (5 ph√∫t)

# Embedding Threshold (ChatbotAssistantUserService)
# EMBEDDING_SIMILARITY_THRESHOLD: 0.5
#   - 0.3-0.5: Tho√°o l∆∞·ªõi, g·ª£i √Ω nhi·ªÅu t√πy ch·ªçn
#   - 0.5-0.7: C√¢n b·∫±ng
#   - 0.7-1.0: Ch·∫∑t ch·∫Ω, ch·ªâ s·∫£n ph·∫©m r·∫•t ph√π h·ª£p

# ==============================================================================
# MONITORING & LOGGING
# ==============================================================================

# Logs ƒë·ªÉ quan s√°t:
# 
# logging:
#   level:
#     com.utephonehub.backend.service.ChatbotAssistantUserService: DEBUG
#     com.utephonehub.backend.service.GeminiEmbeddingService: DEBUG
#     com.utephonehub.backend.service.ProductRecommendationService: DEBUG
#   pattern:
#     console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# ==============================================================================
# COST OPTIMIZATION CHECKLIST
# ==============================================================================

# ‚úÖ Keyword matching (detectIntent) - kh√¥ng t·ªën token
# ‚úÖ Cache products 1 gi·ªù - gi·∫£m 80% API calls
# ‚úÖ Reuse embedding t·ª´ cache - kh√¥ng t·∫°o l·∫°i
# ‚úÖ Max 5 s·∫£n ph·∫©m/response - gi·ªõi h·∫°n output
# ‚úÖ Prompt t·ªëi ∆∞u (300-400 tokens) - ng·∫Øn g·ªçn
# ‚úÖ Ch·ªâ d√πng embedding khi SEARCH intent
# ‚úÖ Batch API calls - kh√¥ng sequential
# 
# ∆Ø·ªõc t√≠nh chi ph√≠:
# - 1000 chat/ng√†y KH√îNG t·ªëi ∆∞u: ~$56
# - 1000 chat/ng√†y C√ì t·ªëi ∆∞u: ~$4.40
# - Ti·∫øt ki·ªám: 92% üí∞

# ==============================================================================
# TROUBLESHOOTING
# ==============================================================================

# ‚ùå "GEMINI_API_KEY not found"
# ‚Üí Ki·ªÉm tra .env ho·∫∑c docker-compose environment variables
# ‚Üí Restart container

# ‚ùå "401 Unauthorized from Gemini"
# ‚Üí API key sai ho·∫∑c h·∫øt h·∫°n
# ‚Üí V√†o ai.google.dev regenerate key

# ‚ùå "Products API returns empty"
# ‚Üí Ki·ªÉm tra /api/v1/products/featured endpoint
# ‚Üí Verify URL: http://localhost:8081/api/v1/products/featured

# ‚ùå "High latency (>5s)"
# ‚Üí Cache ch∆∞a populate: ch·∫°y l·∫°i 2-3 l·∫ßn
# ‚Üí Disable embedding: ch·ªâ d√πng API direct
# ‚Üí Check DB/API performance

# ‚ùå "Out of embedding quota"
# ‚Üí Free tier limit: 15 RPM
# ‚Üí Solution: upgrade to paid tier ho·∫∑c reduce embedding usage

# ==============================================================================
# ƒê·ªåC TH√äM
# ==============================================================================
# 
# üìñ Full Documentation: docs/CHATBOT_ASSISTANT.md
# ‚ö° Quick Start: docs/CHATBOT_QUICK_START.md
# üì¶ Files Created: docs/CHATBOT_FILES_CREATED.md
# üîó Gemini API: https://ai.google.dev/docs
# üì± ProductView API: [t·ª´ SRS c·ªßa UTE Phone Hub]

