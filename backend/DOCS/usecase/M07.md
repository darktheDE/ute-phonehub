# **1. Các chức năng cần xây dựng**

### 1.1. Đối với Khách hàng đã đăng ký (Registered Customer)

1. **Xem lịch sử đơn hàng**
    - Hiển thị tất cả đơn hàng mà khách đã đặt, kèm thông tin tóm tắt: mã đơn, ngày đặt, tổng tiền, trạng thái.
2. **Xem chi tiết & theo dõi trạng thái đơn hàng**
    - Khi bấm vào một đơn, khách xem được đầy đủ thông tin: người nhận, địa chỉ, danh sách sản phẩm, tổng tiền, phương thức thanh toán, trạng thái hiện tại và lịch sử/timeline trạng thái.
3. **Xem/Lưu mã QR đơn hàng**
    - Trên màn hình chi tiết đơn, hệ thống hiển thị mã QR tương ứng với đơn đó để khách có thể lưu lại và đưa cho nhân viên quét tại cửa hàng.
4. **Hủy đơn hàng**
    - Hủy đơn hàng: cho phép khách hàng chủ động hủy đơn của chính họ khi đơn còn ở trạng thái chờ xác nhận (pending).

---

### 1.2. Đối với Người dùng công khai (không cần đăng nhập)

1. **Trang tra cứu đơn hàng công khai**
    - Giao diện cho phép nhập Mã đơn + Email (hoặc thông tin liên hệ tương đương) để tra cứu trạng thái đơn hàng.
2. **Tra cứu đơn hàng thông qua mã QR**
    - Khi người dùng quét mã QR của đơn, hệ thống tự động điền thông tin và hiển thị kết quả tra cứu đơn hàng tương ứng (nếu hợp lệ).

---

### 1.3. Đối với Quản trị viên (Admin)

1. **Xem & lọc danh sách đơn hàng**
    - Màn hình quản trị hiển thị danh sách tất cả đơn hàng trên hệ thống, hỗ trợ tìm kiếm/lọc theo các tiêu chí: mã đơn, thông tin khách, trạng thái, thời gian tạo…
2. **Xem chi tiết đơn hàng (Admin)**
    - Khi chọn một đơn trong danh sách, Admin xem được đầy đủ thông tin đơn hàng, tương tự khách hàng nhưng có thể kèm thêm thông tin nội bộ nếu cần.
3. **Cập nhật trạng thái đơn hàng**
    - Admin có thể thay đổi trạng thái đơn theo luồng nghiệp vụ (pending → processing → shipped → delivered hoặc cancelled), kèm kiểm tra ràng buộc chuyển trạng thái hợp lệ.
4. **Xác nhận đơn tại cửa hàng bằng QR**
    - Tại cửa hàng, Admin/nhân viên dùng chức năng quét mã QR để tra cứu nhanh đơn hàng và đánh dấu đơn đã giao/đã hoàn thành cho khách.

## 2. Yêu cầu Chức năng (Functional Requirements)

**Module: Quản lý & Theo dõi Đơn hàng (Order Tracking & QR Code)**

Module này cung cấp cho **Khách hàng**, **Người dùng công khai** và **Quản trị viên** các chức năng cần thiết để:

- Theo dõi trạng thái đơn hàng sau khi đặt.
- Tạo và sử dụng **mã QR** cho mỗi đơn để tra cứu/xác nhận nhanh.
- Quản lý vòng đời đơn hàng trong khu vực quản trị.

### Functional Requirements

| Mã | Yêu cầu Chức năng |
| --- | --- |
| **[FR-ORDER-01]** | Hệ thống phải cho phép **Khách hàng đã đăng ký** xem **danh sách tất cả đơn hàng** gắn với tài khoản của họ, kèm thông tin tóm tắt: mã đơn, ngày đặt, tổng tiền, trạng thái. |
| **[FR-ORDER-02]** | Hệ thống phải cho phép **Khách hàng** xem **chi tiết một đơn hàng**, bao gồm: thông tin người nhận, địa chỉ, danh sách sản phẩm, tổng tiền, phương thức thanh toán, trạng thái hiện tại và thời gian tạo/cập nhật. |
| **[FR-ORDER-03]** | Hệ thống phải **tự động tạo và hiển thị mã QR riêng cho từng đơn hàng** trên màn hình chi tiết đơn, để khách hàng hoặc Admin có thể sử dụng để tra cứu/xác nhận tại cửa hàng. |
| **[FR-ORDER-04]** | Hệ thống phải đảm bảo **mỗi mã QR chỉ tương ứng với đúng một đơn hàng**, chứa đủ thông tin/định danh để hệ thống tra cứu chính xác đơn hàng đó. |
| **[FR-ORDER-05]** | Hệ thống phải cung cấp **trang tra cứu đơn hàng công khai**, cho phép người dùng **không cần đăng nhập** nhập **Mã đơn + thông tin liên hệ (ví dụ: Email)** để xem trạng thái và thông tin tóm tắt của đơn hàng. |
| **[FR-ORDER-06]** | Khi người dùng **quét mã QR** của một đơn hàng, hệ thống phải cho phép **tra cứu nhanh** và hiển thị kết quả tương đương trang tra cứu công khai nếu dữ liệu trong QR hợp lệ. |
| **[FR-ORDER-07]** | Hệ thống phải cho phép **Admin** xem **danh sách tất cả đơn hàng**, hỗ trợ **tìm kiếm, phân trang và lọc** theo các tiêu chí như: mã đơn, khách hàng, trạng thái, khoảng thời gian tạo, phương thức thanh toán… |
| **[FR-ORDER-08]** | Hệ thống phải cho phép **Admin** xem **chi tiết từng đơn hàng** trong khu vực quản trị, với đầy đủ thông tin khách hàng, địa chỉ, danh sách sản phẩm, áp dụng voucher (nếu có), tổng tiền, trạng thái, phương thức thanh toán. |
| **[FR-ORDER-09]** | Hệ thống phải cho phép **Admin** cập nhật **trạng thái đơn hàng** theo các bước hợp lệ (ví dụ: pending → processing → shipped → delivered hoặc cancelled) và **không cho phép** chuyển trạng thái trái với quy tắc nghiệp vụ (ví dụ: từ delivered quay lại shipped). |
| **[FR-ORDER-10]** | Hệ thống phải cung cấp chức năng **“Xác nhận đơn tại cửa hàng”**, cho phép Admin/nhân viên sử dụng **mã QR của khách** để tra cứu đơn hàng và cập nhật trạng thái đơn sang “Đã giao/Delivered” khi khách đã nhận hàng. |
| **[FR-ORDER-11]** | Hệ thống phải đảm bảo **phân quyền truy cập dữ liệu đơn hàng**: Khách hàng chỉ xem được các đơn hàng của chính họ; người dùng công khai chỉ xem được thông tin tóm tắt thông qua tra cứu; Admin có thể xem và chỉnh sửa đơn hàng trên toàn hệ thống. |
| **[FR-ORDER-12]** | Khi trạng thái đơn hàng thay đổi, hệ thống nên **ghi nhận lịch sử thay đổi trạng thái** (thời gian, trạng thái cũ/mới, người thực hiện) để phục vụ truy vết và hiển thị timeline cho người dùng (nếu cần). |
| **[FR-ORDER-13]** | Hệ thống phải cho phép Khách hàng **đã đăng ký** tự hủy đơn hàng của chính họ khi đơn hàng đang ở trạng thái **pending** (Chờ xác nhận). |
| **[FR-ORDER-14]** | Hệ thống **không được phép** cho khách hàng hủy các đơn hàng ở các trạng thái **processing, shipped, delivered, cancelled** và phải hiển thị thông báo phù hợp khi khách cố gắng hủy trong các trạng thái này. |
| **[FR-ORDER-15]** | Hệ thống phải đảm bảo khi thực hiện thao tác hủy, trạng thái hiện tại của đơn hàng được kiểm tra lại ngay trước khi cập nhật, để tránh trường hợp đơn đã được xử lý sang trạng thái khác trong lúc khách đang xem màn hình. |

# **3. Đặc tả Use case**

## **3.1. Xem lịch sử & chi tiết đơn hàng của khách hàng**

| Mục | Nội dung |
| --- | --- |
| Use case | Xem lịch sử & chi tiết đơn hàng (Registered Customer) |
| Actor | Registered Customer |
| Trigger | Actor đăng nhập và chọn mục “Đơn hàng của tôi” trên giao diện người dùng. |
| Description | Use case này cho phép khách hàng đã đăng ký xem danh sách các đơn hàng của chính họ và xem chi tiết từng đơn hàng. Hệ thống lấy dữ liệu từ các bảng đơn hàng (orders), chi tiết đơn hàng (order_items) và sản phẩm (products). |
| Pre-Conditions | - Actor đã đăng nhập hệ thống với vai trò khách hàng.
- Trong hệ thống có thể đã tồn tại 0 hoặc nhiều đơn hàng gắn với tài khoản của Actor. |
| Post-Conditions | - Danh sách đơn hàng của đúng khách hàng được hiển thị trên giao diện.
- Khi xem chi tiết, hệ thống chỉ đọc dữ liệu, không làm thay đổi bất kỳ thông tin nào của đơn hàng. |
| Main Flow | 1. Actor đăng nhập vào hệ thống.
2. Actor chọn mục “Đơn hàng của tôi”.
3. Hệ thống xác định tài khoản hiện tại và truy xuất tất cả đơn hàng thuộc khách hàng này từ cơ sở dữ liệu.
4. Hệ thống hiển thị danh sách đơn hàng: mã đơn (orderCode), ngày tạo, tổng tiền, trạng thái, phương thức thanh toán…
5. Actor chọn một đơn hàng cụ thể trong danh sách.
6. Hệ thống kiểm tra quyền truy cập, đảm bảo đơn hàng thuộc khách hàng hiện tại.
7. Hệ thống lấy chi tiết đơn hàng tương ứng (thông tin người nhận, địa chỉ, danh sách sản phẩm, tổng tiền, trạng thái, phương thức thanh toán…).
8. Hệ thống hiển thị đầy đủ chi tiết đơn hàng cho Actor, bao gồm cả mã QR của đơn (nếu có). |
| Alternate Flow | - AF-1: Khách chưa có đơn hàng nào
  + Ở bước 3, nếu không tìm thấy đơn hàng nào, hệ thống hiển thị danh sách rỗng.
  + Giao diện hiển thị thông báo: “Bạn chưa có đơn hàng nào.” và gợi ý khách quay về trang sản phẩm. |
| Exception Flow | - EX-1: Phiên đăng nhập không hợp lệ hoặc hết hạn
  + Khi Actor truy cập “Đơn hàng của tôi”, nếu phiên làm việc không còn hợp lệ, hệ thống chuyển hướng về màn hình đăng nhập.
- EX-2: Đơn hàng không thuộc khách hiện tại
  + Ở bước 6, nếu đơn hàng không thuộc tài khoản đang đăng nhập, hệ thống từ chối và hiển thị thông báo “Không tìm thấy đơn hàng.”, giữ nguyên tại danh sách.
- EX-3: Lỗi hệ thống
  + Nếu có lỗi khi truy xuất dữ liệu, hệ thống hiển thị thông báo chung “Có lỗi xảy ra, vui lòng thử lại sau.” và không hiển thị danh sách/chi tiết. |

## **3.2. Quản lý & cập nhật trạng thái đơn hàng (Admin)**

| Mục | Nội dung |
| --- | --- |
| Use case | Quản lý & cập nhật trạng thái đơn hàng (Admin) |
| Actor | Admin |
| Trigger | - Trigger A: Actor chọn menu “Quản lý Đơn hàng” trên giao diện quản trị.
- Trigger B: Actor mở màn hình “Quét mã QR đơn hàng” để xác nhận đơn tại cửa hàng. |
| Description | Use case này cho phép Admin xem danh sách đơn hàng, xem chi tiết từng đơn và cập nhật trạng thái xử lý của đơn (pending → processing → shipped → delivered hoặc cancelled). Tại cửa hàng, Admin/nhân viên có thể sử dụng chức năng quét mã QR để tra cứu nhanh và xác nhận đơn hàng đã giao. |
| Pre-Conditions | - Actor đã đăng nhập hệ thống với vai trò Admin.
- Trong cơ sở dữ liệu đã có các đơn hàng (bảng orders).
- Với luồng quét QR tại cửa hàng: khách hàng có mã QR hợp lệ của đơn (từ hệ thống). |
| Post-Conditions | - Thông tin đơn hàng và trạng thái hiện tại được hiển thị đúng trên giao diện quản trị.
- Khi Actor cập nhật trạng thái, giá trị trạng thái của đơn hàng trong cơ sở dữ liệu được thay đổi theo quy tắc nghiệp vụ. |
| Main Flow | 1. Actor đăng nhập vào khu vực quản trị.
2. Actor chọn chức năng “Quản lý Đơn hàng”.
3. Hệ thống truy xuất danh sách đơn hàng và hiển thị theo các tiêu chí mặc định (ví dụ: sắp xếp theo ngày tạo, lọc theo trạng thái).
4. Actor có thể sử dụng các bộ lọc (mã đơn, email/điện thoại khách, trạng thái, khoảng thời gian…) để thu hẹp danh sách.
5. Hệ thống áp dụng bộ lọc và cập nhật lại danh sách đơn hàng.
6. Actor chọn một đơn bất kỳ để xem chi tiết.
7. Hệ thống lấy thông tin chi tiết đơn hàng (thông tin khách, địa chỉ, danh sách sản phẩm, tổng tiền, trạng thái hiện tại, hình thức thanh toán, ngày tạo/cập nhật…) và hiển thị cho Actor.
8. Actor bấm nút “Cập nhật trạng thái”, chọn trạng thái mới phù hợp (ví dụ: từ pending sang processing, từ shipped sang delivered, hoặc cancelled) và xác nhận.
9. Hệ thống kiểm tra tính hợp lệ của bước chuyển trạng thái (không cho phép chuyển từ trạng thái cuối cùng như delivered/cancelled sang trạng thái xử lý khác).
10. Nếu hợp lệ, hệ thống cập nhật trạng thái đơn hàng trong cơ sở dữ liệu, ghi nhận thời gian cập nhật và (tuỳ thiết kế) lưu log lịch sử.
11. Hệ thống hiển thị thông báo “Cập nhật trạng thái thành công” và làm mới thông tin đơn trên giao diện. |
| Alternate Flow | - AF-1: Xác nhận đơn tại cửa hàng bằng mã QR
  1. Actor mở chức năng “Quét mã QR đơn hàng” trên giao diện quản trị.
  2. Hệ thống kích hoạt camera/thiết bị quét và chờ Actor quét mã QR từ thiết bị/hóa đơn của khách.
  3. Sau khi quét, hệ thống đọc dữ liệu trong mã QR (ví dụ: mã đơn và email/định danh đơn hàng) rồi thực hiện tra cứu đơn tương ứng trong cơ sở dữ liệu.
  4. Nếu tìm thấy, hệ thống hiển thị thông tin tóm tắt đơn hàng: mã đơn, tên khách, tổng tiền, trạng thái hiện tại.
  5. Actor xác nhận với khách và chọn chức năng “Đánh dấu là đã giao/DELIVERED”.
  6. Hệ thống kiểm tra tính hợp lệ và cập nhật trạng thái đơn hàng sang delivered, hiển thị thông báo thành công. |
| Exception Flow | - EX-1: Actor không đủ quyền Admin
  + Khi truy cập khu vực quản trị hoặc chức năng quản lý đơn hàng, nếu Actor không có quyền phù hợp, hệ thống chặn truy cập và hiển thị thông báo lỗi.
- EX-2: Đơn hàng không tồn tại
  + Khi Actor chọn xem chi tiết một đơn hoặc tra cứu đơn bằng QR nhưng cơ sở dữ liệu không có bản ghi tương ứng, hệ thống hiển thị “Không tìm thấy đơn hàng.”
- EX-3: Chuyển trạng thái không hợp lệ
  + Khi Actor chọn trạng thái mới không nằm trong chuỗi xử lý hợp lệ (ví dụ chuyển từ delivered về shipped), hệ thống hiển thị thông báo “Trạng thái đơn hàng không hợp lệ.” và không cập nhật.
- EX-4: Mã QR/Thông tin tra cứu không khớp
  + Trong luồng quét QR, nếu hệ thống không thể tìm thấy đơn phù hợp với dữ liệu trên mã QR, hệ thống hiển thị “Mã QR không hợp lệ hoặc đơn hàng không tồn tại.”
- EX-5: Lỗi hệ thống
  + Nếu xảy ra lỗi khi truy xuất/cập nhật dữ liệu, hệ thống hiển thị thông báo lỗi chung và giữ nguyên trạng thái đơn hàng. |

## **3.3. Hiển thị mã QR Code cho đơn hàng**

| Mục | Nội dung |
| --- | --- |
| Use case | Hiển thị mã QR Code cho đơn hàng |
| Actor | Registered Customer, Admin |
| Trigger | - Sau khi khách hàng đặt hàng thành công.
- Hoặc Actor mở màn hình chi tiết của một đơn hàng cụ thể. |
| Description | Use case này cho phép hệ thống sinh và hiển thị một mã QR dành cho từng đơn hàng. Mã QR chứa thông tin/đường dẫn giúp tra cứu nhanh đơn hàng hoặc hỗ trợ xác nhận đơn tại cửa hàng. |
| Pre-Conditions | - Đơn hàng đã được tạo và lưu trong bảng orders với mã đơn (order_code) và thông tin liên hệ của khách.
- Hệ thống có chức năng sinh mã QR từ chuỗi dữ liệu đầu vào. |
| Post-Conditions | - Mã QR của đơn hàng được hiển thị trên giao diện chi tiết đơn cho khách hàng và/hoặc Admin.
- Khách hàng có thể lưu hoặc trình mã QR này cho nhân viên khi đến cửa hàng. |
| Main Flow | 1. Sau khi hoàn tất đặt hàng, hệ thống chuyển khách đến màn hình hiển thị thông tin đơn hàng hoặc cho phép khách mở chi tiết đơn trong phần “Đơn hàng của tôi”.
2. Khi hiển thị chi tiết đơn, hệ thống chuẩn bị dữ liệu định danh đơn hàng (ví dụ: order_code và email/định danh khách hàng).
3. Hệ thống tạo một chuỗi dữ liệu hoặc đường dẫn dùng để tra cứu đơn hàng dựa trên thông tin định danh đó.
4. Chức năng sinh QR nhận chuỗi dữ liệu/đường dẫn và tạo ra ảnh mã QR tương ứng.
5. Hệ thống hiển thị ảnh mã QR trong khu vực “Mã QR đơn hàng” trên giao diện chi tiết đơn.
6. Khi Admin xem chi tiết đơn trên giao diện quản trị, hệ thống cũng hiển thị mã QR tương tự để nhân viên có thể quét nếu cần. |
| Alternate Flow | - AF-1: Mã QR được tạo sẵn và lưu trữ
  + Thay vì sinh QR mỗi lần mở chi tiết, hệ thống có thể sinh mã QR ngay khi đơn được tạo và lưu đường dẫn/ảnh QR trong cơ sở dữ liệu.
  + Khi người dùng mở chi tiết đơn, hệ thống chỉ cần tải ảnh QR đã lưu sẵn lên giao diện. |
| Exception Flow | - EX-1: Lỗi khi sinh hoặc tải mã QR
  + Nếu việc sinh ảnh QR thất bại hoặc ảnh QR không tồn tại, hệ thống hiển thị thông báo “Hiện tại không thể hiển thị mã QR, vui lòng thử lại sau.” nhưng không ảnh hưởng đến thông tin đơn hàng.
- EX-2: Đơn hàng không tồn tại hoặc không đủ dữ liệu định danh
  + Nếu hệ thống không xác định được mã đơn hoặc thông tin cần thiết, chức năng hiển thị QR sẽ bị vô hiệu và hệ thống có thể ẩn phần hiển thị mã QR trên giao diện. |

## **3.4. Tra cứu đơn hàng công khai (không cần đăng nhập)**

| Mục | Nội dung |
| --- | --- |
| Use case | Tra cứu đơn hàng công khai (không cần đăng nhập) |
| Actor | Unregistered Customer/ Registered Customer |
| Trigger | - Actor truy cập trang “Tra cứu đơn hàng” trên website.
- Hoặc Actor quét mã QR của đơn hàng, trình duyệt mở trang tra cứu kèm sẵn một số thông tin. |
| Description | Use case này cho phép người dùng không cần đăng nhập vẫn có thể tra cứu trạng thái và thông tin tóm tắt của một đơn hàng, thông qua việc cung cấp mã đơn và thông tin liên hệ (ví dụ: email). |
| Pre-Conditions | - Đơn hàng đã tồn tại trong hệ thống với mã đơn (order_code) và thông tin liên hệ (email/điện thoại) tương ứng.
- Trang tra cứu đơn hàng công khai đã được cấu hình và có thể kết nối tới cơ sở dữ liệu. |
| Post-Conditions | - Nếu thông tin tra cứu hợp lệ, hệ thống hiển thị trạng thái và thông tin tóm tắt của đơn hàng cho người dùng.
- Không có thao tác nào từ use case này thay đổi dữ liệu đơn hàng. |
| Main Flow | 1. Actor truy cập trang “Tra cứu đơn hàng”.
2. Hệ thống hiển thị form với các trường: Mã đơn hàng (orderCode) và Email (hoặc trường thông tin liên hệ khác được yêu cầu).
3. Actor nhập đầy đủ thông tin và bấm nút “Tra cứu”.
4. Hệ thống kiểm tra dữ liệu nhập vào (không để trống, đúng định dạng cơ bản của email/mã đơn).
5. Hệ thống tìm kiếm trong cơ sở dữ liệu đơn hàng có mã đơn và thông tin liên hệ trùng khớp.
6. Nếu tìm thấy, hệ thống lấy thông tin tóm tắt của đơn hàng: mã đơn, ngày đặt, tổng tiền, trạng thái hiện tại, phương thức nhận hàng/thanh toán, người nhận, khu vực giao hàng…
7. Hệ thống hiển thị kết quả tra cứu cho Actor trên giao diện, kèm theo (tuỳ chọn) một timeline trạng thái rút gọn. |
| Alternate Flow | - AF-1: Tra cứu thông qua mã QR
  1. Actor sử dụng camera hoặc ứng dụng quét mã QR của đơn hàng.
  2. Nội dung QR chứa sẵn mã đơn và (có thể) email hoặc một đường dẫn có tham số tương đương.
  3. Trình duyệt mở trang tra cứu và hệ thống tự động điền trước thông tin mã đơn/email hoặc đọc dữ liệu từ đường dẫn.
  4. Hệ thống thực hiện các bước kiểm tra và tìm kiếm trong cơ sở dữ liệu tương tự bước 4–6 của luồng chính.
  5. Kết quả tra cứu được hiển thị như luồng chính. |
| Exception Flow | - EX-1: Dữ liệu nhập không hợp lệ
  + Nếu Actor bỏ trống hoặc nhập sai định dạng các trường bắt buộc, hệ thống hiển thị thông báo lỗi và yêu cầu nhập lại, không thực hiện tra cứu.
- EX-2: Không tìm thấy đơn hàng
  + Nếu không có đơn hàng nào trùng khớp với mã đơn và thông tin liên hệ, hệ thống hiển thị thông báo “Không tìm thấy đơn hàng, vui lòng kiểm tra lại thông tin.”
- EX-3: Dữ liệu từ mã QR không hợp lệ
  + Trong luồng tra cứu bằng QR, nếu dữ liệu đọc được không đầy đủ hoặc không khớp với bất kỳ đơn hàng nào, hệ thống hiển thị thông báo “Mã QR hoặc liên kết tra cứu không hợp lệ.” và gợi ý người dùng nhập lại bằng form.
- EX-4: Lỗi hệ thống
  + Nếu xảy ra lỗi khi xử lý tra cứu, hệ thống hiển thị thông báo chung “Có lỗi xảy ra khi tra cứu đơn hàng, vui lòng thử lại sau.” |
|  |  |
|  |  |

### **3.5. Hủy đơn hàng (Customer Cancel Order)**

| Mục | Nội dung |
| --- | --- |
| Use case | Hủy đơn hàng (Customer Cancel Order) |
| Actor | Registered Customer |
| Trigger | Actor mở “Đơn hàng của tôi”, chọn một đơn hàng đang ở trạng thái cho phép hủy và bấm nút “Hủy đơn hàng”. |
| Description | Use case này cho phép khách hàng đã đăng ký chủ động hủy một đơn hàng của chính họ khi đơn hàng vẫn đang ở trạng thái chờ xác nhận (pending), chưa được hệ thống hoặc Admin xử lý/giao hàng. Sau khi hủy thành công, trạng thái đơn được chuyển sang cancelled. |
| Pre-Conditions | - Actor đã đăng nhập hệ thống với vai trò khách hàng.
- Đơn hàng thuộc về tài khoản của Actor.
- Đơn hàng đang ở trạng thái pending (Chờ xác nhận). Đây là trạng thái duy nhất cho phép khách hàng tự hủy. |
| Post-Conditions | - Nếu hủy thành công: trạng thái đơn hàng được chuyển sang cancelled, thời gian cập nhật được ghi nhận.
- Nếu việc hủy không hợp lệ (do trạng thái đã thay đổi…), đơn hàng giữ nguyên trạng thái ban đầu. |
| Main Flow | 1. Actor đăng nhập và đi tới mục “Đơn hàng của tôi”.
2. Hệ thống hiển thị danh sách các đơn hàng của Actor, bao gồm trạng thái hiện tại của từng đơn.
3. Actor chọn một đơn hàng đang ở trạng thái pending và bấm nút “Xem chi tiết”.
4. Hệ thống hiển thị chi tiết đơn hàng, kèm nút “Hủy đơn hàng” (vì đơn đang ở trạng thái cho phép hủy).
5. Actor bấm “Hủy đơn hàng”.
6. Hệ thống hiển thị hộp thoại xác nhận, thông báo rõ: “Bạn có chắc muốn hủy đơn này? Sau khi hủy, đơn không thể khôi phục.” với các lựa chọn “Xác nhận” và “Không”.
7. Actor bấm “Xác nhận”.
8. Hệ thống kiểm tra lại trạng thái hiện tại của đơn hàng để đảm bảo đơn vẫn đang ở trạng thái pending.
9. Nếu trạng thái vẫn là pending, hệ thống cập nhật trạng thái đơn sang cancelled và ghi nhận thời gian cập nhật (và lý do hủy nếu có).
10. Hệ thống hiển thị thông báo “Hủy đơn hàng thành công” và cập nhật giao diện chi tiết đơn hiển thị trạng thái “Đã hủy”. |
| Alternate Flow | - AF-1: Khách hàng đổi ý, không hủy nữa
  1. Ở bước 6, Actor bấm “Không” hoặc đóng hộp thoại xác nhận.
  2. Hệ thống đóng hộp thoại, giữ nguyên trạng thái đơn hàng (pending) và không có thay đổi nào khác. |
| Exception Flow | - EX-1: Trạng thái đơn không còn cho phép hủy
  + Ở bước 8, nếu hệ thống phát hiện đơn hàng đã chuyển sang processing, shipped, delivered hoặc cancelled, hệ thống không cập nhật sang cancelled.
  + Hệ thống hiển thị thông báo: “Đơn hàng đã được xử lý, không thể hủy.” và giữ nguyên trạng thái mới nhất của đơn.
- EX-2: Đơn hàng không thuộc khách hiện tại
  + Nếu đơn không còn thuộc về tài khoản đang đăng nhập, hệ thống từ chối thao tác và hiển thị thông báo: “Không tìm thấy đơn hàng.”
- EX-3: Lỗi hệ thống khi cập nhật
  + Nếu xảy ra lỗi trong quá trình ghi dữ liệu, hệ thống thông báo: “Hủy đơn hàng không thành công, vui lòng thử lại sau.” và giữ nguyên trạng thái đơn ban đầu (pending). |