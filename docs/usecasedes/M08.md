1. **Các Chức Năng Cần Xây Dựng: Đánh giá & Tương tác**

**1.1. Đối với Khách hàng đã đăng ký (Registered Customer)**

| **Nhóm chức năng** | **Tên chức năng** | **Mô tả chi tiết** |
| --- | --- | --- |
| **Viết & Sửa Đánh giá** | **Đăng đánh giá (Review/Rating)** | **Cho phép khách hàng đã mua sản phẩm (và đơn hàng đã hoàn thành) chấm số sao (1-5), viết nhận xét và đính kèm ảnh/video cho sản phẩm đó (FR-RV-01).** |
|  | **Chỉnh sửa đánh giá** | **Cho phép khách hàng chỉnh sửa nội dung, số sao, hoặc cập nhật/thay thế ảnh/video cho đánh giá đã đăng của chính họ (FR-RV-03).** |
|  | **Xóa đánh giá cá nhân** | **Cho phép khách hàng xóa vĩnh viễn đánh giá của chính họ và hệ thống tự động tính toán lại điểm trung bình (FR-RV-04).** |
| **Tương tác Đánh giá** | **Like/Unlike (Đánh dấu hữu ích)** | **Cho phép khách hàng thể hiện sự đồng tình/không đồng tình (Like/Unlike) với các đánh giá của người dùng khác theo logic 3 trạng thái (Like/Unlike/Không tương tác) (FR-RT-01, FR-RT-02).** |

**1.2. Đối với Tất cả người dùng (User chưa/đã đăng ký)**

| **Nhóm chức năng** | **Tên chức năng** | **Mô tả chi tiết** |
| --- | --- | --- |
| **Xem Đánh giá** | **Hiển thị Đánh giá & Tóm tắt** | **Cải thiện giao diện: Hiển thị danh sách đánh giá sản phẩm, bao gồm Tóm tắt Rating (điểm trung bình, tổng số đánh giá, biểu đồ phân phối số sao) (FR-DS-01).** |
|  | **Hiển thị trạng thái Khách hàng** | **Hiển thị tag/badge "Đã mua hàng" bên cạnh tên người đánh giá để tăng độ tin cậy (FR-DS-02).** |
|  | **Bộ lọc Đánh giá linh hoạt (Filter)** | **Cung cấp các tùy chọn lọc đánh giá: Theo số sao (1-5 sao) và Có hình ảnh/video đính kèm (FR-DS-03, FR-DS-04).** |
|  | **Sắp xếp Đánh giá** | **Cho phép sắp xếp đánh giá theo các tiêu chí: Mới nhất, Hữu ích nhất (dựa trên số lượng Like/Unlike), và Điểm cao nhất/thấp nhất (FR-DS-05).** |
|  | **Báo cáo Đánh giá** | **Cho phép người dùng báo cáo một đánh giá là không phù hợp/vi phạm chính sách nội dung (FR-MD-02).** |

**1.3. Đối với Quản trị viên (Admin)**

| **Nhóm chức năng** | **Tên chức năng** | **Mô tả chi tiết** |
| --- | --- | --- |
| **Quản lý Đánh giá** | **Duyệt/Ẩn Đánh giá (Moderation)** | **Cho phép Admin xem xét, xóa (ẩn) vĩnh viễn hoặc tạm thời các đánh giá vi phạm chính sách nội dung hoặc bị người dùng báo cáo (FR-MD-01).** |
1. **FR - Viết, Sửa & Xóa Đánh giá (Review Management)**

| **Mã Yêu cầu** | **Tên Yêu cầu** | **Mô tả chi tiết** | **Actor** |
| --- | --- | --- | --- |
| **FR-RV-01** | **Tạo Đánh giá (Review/Rating)** | Hệ thống **phải** cho phép Khách hàng đã đăng nhập chấm số sao (1-5), viết nhận xét và đính kèm tối đa **N** ảnh/video cho sản phẩm **đã mua** và **đơn hàng đã hoàn thành**. | Registered Customer |
| **FR-RV-02** | **Điều kiện Đánh giá** | Hệ thống **phải** kiểm tra để đảm bảo chỉ những Khách hàng có **đơn hàng hoàn thành** chứa sản phẩm đó mới được phép tạo đánh giá. | Registered Customer |
| **FR-RV-03** | **Chỉnh sửa Đánh giá** | Hệ thống **phải** cho phép Khách hàng chỉnh sửa nội dung, số sao, hoặc cập nhật/thay thế ảnh/video cho đánh giá đã đăng của chính họ. | Registered Customer |
| **FR-RV-04** | **Xóa Đánh giá Cá nhân** | Hệ thống **phải** cho phép Khách hàng xóa vĩnh viễn đánh giá của chính họ. Khi xóa, hệ thống **phải** tự động tính toán lại **Rating trung bình** của sản phẩm. | Registered Customer |
| **FR-RV-05** | **Xác thực Đính kèm** | Hệ thống **phải** giới hạn kích thước (ví dụ: tối đa 5MB/ảnh) và định dạng tệp (ví dụ: JPG, PNG, MP4) cho ảnh và video đính kèm. | Registered Customer |
1. **FR - Tương tác Đánh giá (Interaction)**

| **Mã Yêu cầu** | **Tên Yêu cầu** | **Mô tả chi tiết** | **Actor** |
| --- | --- | --- | --- |
| **FR-RT-01** | **Like/Unlike (Đánh dấu hữu ích)** | Hệ thống **phải** cho phép Khách hàng đã đăng nhập thể hiện sự đồng tình/không đồng tình (Like/Unlike) với các đánh giá của người dùng khác. | Registered Customer |
| **FR-RT-02** | **Logic Tương tác** | Hệ thống **phải** đảm bảo một người dùng chỉ có thể ở **một trong ba trạng thái** cho mỗi đánh giá: Like, Unlike, hoặc Không tương tác. Nếu người dùng click lại vào trạng thái đã chọn (ví dụ: click Like lần 2), trạng thái đó **phải** được hủy bỏ. | Registered Customer |
| **FR-RT-03** | **Cập nhật tương tác (Real-time)** | Số lượng Like/Unlike **phải** được cập nhật tức thời trên giao diện người dùng (ví dụ: sử dụng React Component) mà không cần tải lại trang. | Tất cả người dùng |
1. **FR - Hiển thị & Lọc Đánh giá (Display & Filtering)**

| **Mã Yêu cầu** | **Tên Yêu cầu** | **Mô tả chi tiết** | **Actor** |
| --- | --- | --- | --- |
| **FR-DS-01** | **Hiển thị Tóm tắt Rating** | Hệ thống **phải** hiển thị Tóm tắt Rating bao gồm: **Điểm trung bình** (ví dụ: 4.5/5.0), **Tổng số lượng đánh giá**, và **Biểu đồ phân phối số sao** (tỷ lệ 1-5 sao). | Tất cả người dùng |
| **FR-DS-02** | **Hiển thị Trạng thái mua hàng** | Hệ thống **phải** hiển thị nhãn/badge (ví dụ: **"Đã mua hàng"**) bên cạnh tên người đánh giá nếu người đó đã mua sản phẩm đang được đánh giá. | Tất cả người dùng |
| **FR-DS-03** | **Lọc theo Số sao** | Hệ thống **phải** cung cấp tùy chọn lọc đánh giá theo số sao cụ thể (ví dụ: chỉ hiển thị 5 sao, 4 sao, v.v.). | Tất cả người dùng |
| **FR-DS-04** | **Lọc theo Media** | Hệ thống **phải** cung cấp tùy chọn lọc để chỉ hiển thị các đánh giá có đính kèm **hình ảnh hoặc video**. | Tất cả người dùng |
| **FR-DS-05** | **Sắp xếp Đánh giá** | Hệ thống **phải** cho phép sắp xếp danh sách đánh giá theo các tiêu chí: **Mới nhất**, **Hữu ích nhất** (dựa trên Like/Unlike), và **Điểm cao nhất/thấp nhất**. | Tất cả người dùng |
| **FR-DS-06** | **Xử lý Không có Đánh giá** | Nếu sản phẩm chưa có đánh giá, hệ thống **phải** hiển thị thông báo thân thiện (ví dụ: "Sản phẩm này chưa có đánh giá nào.") thay vì hiển thị giao diện trống. | Tất cả người dùng |

**Đặc tả Use Case: Đăng/Sửa Đánh giá Sản phẩm**

| **Mục** | **Nội dung** |
| --- | --- |
| **Use case** | **Đăng/Sửa Đánh giá Sản phẩm** (Create/Edit Review) |
| **Actor** | **Registered Customer** |
| **Trigger** | Actor xem chi tiết sản phẩm và chọn hành động: "Viết đánh giá" hoặc "Sửa đánh giá". |
| **Description** | Cho phép Actor **viết nhận xét**, **chấm số sao** (1-5), và **đính kèm hình ảnh/video** cho sản phẩm đã mua và hoàn thành đơn hàng. |
| **Pre-Conditions** | * Actor đã đăng nhập.
 
* Sản phẩm tồn tại.
 
* **Đơn hàng chứa sản phẩm đã được hoàn thành** (thoả mãn **FR-RV-02**). |
| **Post-Conditions** | * Tạo mới/Cập nhật bản ghi **Product Review**.
 
* Cập nhật lại **Rating trung bình** của sản phẩm (FR-RV-04). |
| **Main Flow** | 1. Actor mở form Đánh giá (nút "Viết đánh giá" hoặc "Sửa đánh giá").
 
2. Hệ thống kiểm tra điều kiện mua hàng (Pre-Conditions).
 
3. Actor chọn **số sao**, nhập **nội dung** và đính kèm **hình ảnh/video** (tối đa N file) (FR-RV-01).
 
4. Actor bấm "Gửi đánh giá".
 
5. Hệ thống gọi **API Tạo/Cập nhật Đánh giá** (TR-API-01).
 
6. Hệ thống xử lý, lưu trữ và **tính toán lại Rating trung bình** (TR-BE-01).
 
7. Hệ thống hiển thị đánh giá mới/cập nhật trên giao diện mà không cần tải lại trang (TR-FE-01). |
| **Alternate Flow** | * **AF-1: Sửa đánh giá:** Nếu Actor đã từng đánh giá, hệ thống hiển thị form với dữ liệu đánh giá cũ và tiếp tục từ bước 4 của Main Flow. |
| **Exception Flow** | * **EX-1: Chưa đủ điều kiện:** Nếu Actor chưa mua hàng/đơn hàng chưa hoàn thành, nút "Viết đánh giá" bị vô hiệu hóa/ẩn. Nếu cố gắng truy cập form, hệ thống báo lỗi: "Bạn chưa đủ điều kiện đánh giá sản phẩm này."
 
* **EX-2: Thiếu dữ liệu bắt buộc:** Nếu thiếu số sao/nội dung, hệ thống ngăn chặn ở Client Side và báo lỗi (FR-DS-01, TR-FE-02).
 
* **EX-3: Lỗi đính kèm:** File quá lớn hoặc sai định dạng, hệ thống chặn upload và báo lỗi (FR-RV-05).
 
* **EX-4: Lỗi API/Server:** Nếu API tạo/cập nhật thất bại, hệ thống hiển thị thông báo "Có lỗi xảy ra, vui lòng thử lại sau" và giữ nguyên dữ liệu trên form. |
1. **Đặc tả Use Case: Tương tác Like/Unlike Đánh giá**

| **Mục** | **Nội dung** |
| --- | --- |
| **Use case** | **Tương tác Like/Unlike Đánh giá** (Review Interaction) |
| **Actor** | **Registered Customer** |
| **Trigger** | Actor xem danh sách đánh giá và bấm nút "Hữu ích" (Like) hoặc "Không hữu ích" (Unlike) của một đánh giá bất kỳ. |
| **Description** | Cho phép Actor thể hiện sự đồng tình/không đồng tình với các đánh giá của người dùng khác, giúp sắp xếp/lọc đánh giá hữu ích. |
| **Pre-Conditions** | * Actor đã đăng nhập.
 
* Đánh giá cần tương tác tồn tại. |
| **Post-Conditions** | * Cập nhật bản ghi **Review Interaction** của người dùng.
 
* Cập nhật số liệu like_count hoặc unlike_count của đánh giá. |
| **Main Flow** | 1. Actor xem một đánh giá và bấm nút **"Hữu ích"** (Like) hoặc **"Không hữu ích"** (Unlike).
 
2. Hệ thống kiểm tra **trạng thái tương tác hiện tại** của Actor đối với đánh giá đó (FR-RT-02).
 
3. Hệ thống gọi **API Tương tác Đánh giá** (TR-API-01) để cập nhật trạng thái mới.
 
4. Hệ thống cập nhật số đếm trên giao diện **(React Component)** tức thời (FR-RT-03). |
| **Alternate Flow** | * **AF-1: Thay đổi trạng thái:** Nếu Actor đang ở trạng thái Like, bấm Unlike sẽ hủy Like và tạo Unlike (hoặc ngược lại) (FR-RT-02).
 
* **AF-2: Hủy trạng thái:** Nếu Actor click lại vào nút đã chọn (ví dụ: đang Like, click Like lần nữa), hệ thống hủy trạng thái và giảm số đếm tương ứng (FR-RT-02). |
| **Exception Flow** | * **EX-1: Chưa đăng nhập:** Nếu Actor chưa đăng nhập, khi click nút, hệ thống hiển thị thông báo: "Vui lòng đăng nhập để đánh dấu hữu ích."
 
* **EX-2: Lỗi API/Server:** Nếu API tương tác bị lỗi, hệ thống không cập nhật số đếm và hiển thị thông báo lỗi chung. |
1. **Đặc tả Use Case: Xem và Lọc Đánh giá Sản phẩm**

| **Mục** | **Nội dung** |
| --- | --- |
| **Use case** | **Xem và Lọc Đánh giá** (View & Filter Reviews) |
| **Actor** | **User chưa đăng ký** hoặc **User đã đăng ký** |
| **Trigger** | Actor xem trang chi tiết sản phẩm và cuộn đến phần đánh giá. |
| **Description** | Cho phép Actor xem danh sách đánh giá của sản phẩm, tóm tắt điểm Rating và sử dụng các bộ lọc/sắp xếp linh hoạt để tìm kiếm thông tin (FR-DS-01 đến FR-DS-05). |
| **Pre-Conditions** | * Sản phẩm tồn tại. |
| **Post-Conditions** | * Hiển thị giao diện đánh giá được cải tiến và danh sách đánh giá đã được lọc/sắp xếp. |
| **Main Flow** | 1. Actor xem trang chi tiết sản phẩm, cuộn đến phần đánh giá.
 
2. Hệ thống gọi **API Lấy Đánh giá** để lấy Tóm tắt Rating và trang đầu tiên của danh sách đánh giá (TR-API-01).
 
3. **Giao diện cải tiến** hiển thị: Tóm tắt Rating (biểu đồ), các Bộ lọc và Danh sách đánh giá.
 
4. Actor chọn một **Bộ lọc** (ví dụ: "Chỉ hiển thị 5 sao" - FR-DS-03) hoặc tùy chọn **Sắp xếp** (ví dụ: "Hữu ích nhất" - FR-DS-05).
 
5. Hệ thống gọi lại **API Lấy Đánh giá** với tham số lọc/sắp xếp tương ứng.
 
6. Hệ thống trả về dữ liệu **đã lọc/sắp xếp** và **React Component** cập nhật lại danh sách đánh giá mà không cần tải lại trang (TR-FE-01). |
| **Alternate Flow** | * **AF-1: Sản phẩm chưa có Review:** Nếu không có đánh giá, hệ thống hiển thị thông báo: "**Sản phẩm này chưa có đánh giá nào.**" (FR-DS-06).
 
* **AF-2: Phân trang/Tải thêm:** Khi cuộn xuống cuối danh sách, hệ thống gọi API để tải thêm đánh giá (load more) thay vì phân trang truyền thống. |
| **Exception Flow** | * **EX-1: Lỗi API/Server:** Nếu API lấy dữ liệu bị lỗi, hệ thống hiển thị thông báo lỗi chung và không hiển thị phần đánh giá. |
1. **Đặc tả Use Case: Quản lý Duyệt/Ẩn Đánh giá (Admin)**

| **Mục** | **Nội dung** |
| --- | --- |
| **Use case** | **Quản lý Duyệt/Ẩn Đánh giá** (Review Moderation) |
| **Actor** | **Administrator** |
| **Trigger** | Admin truy cập vào khu vực "Quản lý Đánh giá" trên Dashboard hoặc nhận thông báo về đánh giá bị người dùng báo cáo. |
| **Description** | Cho phép Admin xem, tìm kiếm, và thực hiện hành động kiểm duyệt (duyệt, ẩn, xóa) đối với các đánh giá của khách hàng (FR-MD-01). |
| **Pre-Conditions** | * Admin đã đăng nhập và có quyền truy cập chức năng Quản lý Đánh giá.
 
* Có đánh giá tồn tại trong hệ thống. |
| **Post-Conditions** | * Trạng thái của đánh giá được cập nhật (Active, Hidden, Deleted).
 
* Nếu xóa/ẩn, Rating trung bình có thể được tính toán lại. |
| **Main Flow** | 1. Admin truy cập trang Quản lý Đánh giá.
 
2. Hệ thống hiển thị danh sách tất cả đánh giá, kèm bộ lọc (theo sản phẩm, theo sao, **đánh giá bị báo cáo**).
 
3. Admin xem xét chi tiết một đánh giá.
 
4. Admin chọn hành động: **"Ẩn"** (tạm thời) hoặc **"Xóa"** (vĩnh viễn) đánh giá vi phạm (FR-MD-01).
 
5. Hệ thống yêu cầu xác nhận hành động.
 
6. Hệ thống gọi API cập nhật trạng thái/xóa bản ghi và tính toán lại Rating nếu cần.
 
7. Hệ thống cập nhật danh sách và thông báo thành công. |
| **Alternate Flow** | * **AF-1: Tìm kiếm/Lọc:** Admin sử dụng bộ lọc để tìm kiếm các đánh giá vi phạm hoặc đánh giá từ một sản phẩm cụ thể. |
| **Exception Flow** | * **EX-1: Lỗi hệ thống:** Nếu có lỗi xảy ra khi thực hiện hành động Xóa/Ẩn, hệ thống hiển thị thông báo lỗi chung. |

# Các điểm cần xem lại

## **1. Thiếu chức năng XÓA ĐÁNH GIÁ**

- Khách hàng cần có khả năng **xóa review của chính mình**.
- Admin cần có khả năng **xóa/ẩn review vi phạm** (moderation).

## **2. Chưa có mô tả trường hợp SẢN PHẨM KHÔNG CÓ ĐÁNH GIÁ**

- Use case đang yêu cầu “sản phẩm có ít nhất 1 đánh giá” → không hợp lý.
- Cần thêm luồng:
    - Nếu không có đánh giá → hiển thị “Chưa có đánh giá”.

## **3. Chưa xử lý trường hợp KHÔNG ĐỦ ĐIỀU KIỆN ĐÁNH GIÁ**

Cần thêm luồng ngoại lệ:

- User chưa đăng nhập → không mở form.
- User chưa từng mua sản phẩm → không thể đánh giá.
- Đơn hàng chưa hoàn thành → không thể đánh giá.

## **4. Thiếu quy tắc LIKE/UNLIKE**

Cần quy định rõ:

- User chỉ được đánh giá khi **đăng nhập**.
- User chỉ được:
    - Like **hoặc** Unlike một đánh giá, hoặc
    - Cho phép đổi trạng thái (Like → Unlike) - Nếu click lại vào nút like thì có được tính 2 lần không, hay hủy trạng thái like ?

## 5. Thiếu logic xử lý lỗi / ngoại lệ

Chưa có Exeption Flow cho các Usecase

- Gửi review nhưng:
    - Thiếu nội dung / không chọn số sao → không biết xử lý ra sao.
- Upload ảnh/video:
    - File quá lớn / sai định dạng / upload thất bại → không nói.
- Gọi API lỗi:
    - 500, timeout → UI/logic không biết rollback hay báo lỗi thế nào.

Người review : Nguyễn Tuấn Huy

Thời gian : 1:42 14/11/2025